142
["/* #[<PREAMBLE>]#\n", " * #[<...>]# から #[</...>]# で囲まれたコメントは編集しないでください\n", " * tecsmerge によるマージに使用されます\n", " *\n", " * 属性アクセスマクロ #_CAAM_#\n", " * NAME_LEN         int16_t          ATTR_NAME_LEN\n", " * name             char_t*          VAR_name\n", " * name2            char_t*          VAR_name2\n", " *\n", " * 呼び口関数 #_TCPF_#\n", " * call port: cTECSInfo signature: nTECSInfo_sTECSInfo context:task\n", " *   ER             cTECSInfo_findNamespace( const char_t* namespace_path, Descriptor( nTECSInfo_sNamespaceInfo )* nsDesc );\n", " *   ER             cTECSInfo_findRegion( const char_t* namespace_path, Descriptor( nTECSInfo_sRegionInfo )* regionDesc );\n", " *   ER             cTECSInfo_findSignature( const char_t* namespace_path, Descriptor( nTECSInfo_sSignatureInfo )* signatureDesc );\n", " *   ER             cTECSInfo_findCelltype( const char_t* namespace_path, Descriptor( nTECSInfo_sCelltypeInfo )* celltypeDesc );\n", " *   ER             cTECSInfo_findCell( const char_t* namespace_path, Descriptor( nTECSInfo_sCellInfo )* cellDesc );\n", " *   ER             cTECSInfo_findRawEntryDescriptor( const char_t* namespace_path, Descriptor( nTECSInfo_sRawEntryDescriptorInfo )* rawEntryDescDesc, Descriptor( nTECSInfo_sEntryInfo )* entryDesc );\n", " *   ER             cTECSInfo_findRawEntryDescriptor_unsafe( const char_t* namespace_path, void** rawDesc );\n", " * call port: cNSInfo signature: nTECSInfo_sNamespaceInfo context:task optional:true\n", " *   bool_t     is_cNSInfo_joined()                     check if joined\n", " *   ER             cNSInfo_getName( char_t* name, int_t max_len );\n", " *   uint16_t       cNSInfo_getNameLength( );\n", " *   uint32_t       cNSInfo_getNNamespace( );\n", " *   ER             cNSInfo_getNamespaceInfo( uint32_t ith, Descriptor( nTECSInfo_sNamespaceInfo )* des );\n", " *   uint32_t       cNSInfo_getNSignature( );\n", " *   ER             cNSInfo_getSignatureInfo( uint32_t ith, Descriptor( nTECSInfo_sSignatureInfo )* des );\n", " *   uint32_t       cNSInfo_getNCelltype( );\n", " *   ER             cNSInfo_getCelltypeInfo( uint32_t ith, Descriptor( nTECSInfo_sCelltypeInfo )* des );\n", " *   [dynamic, optional]\n", " *      void           cNSInfo_set_descriptor( Descriptor( nTECSInfo_sNamespaceInfo ) desc );\n", " *      void           cNSInfo_unjoin(  );\n", " * call port: cRegionInfo signature: nTECSInfo_sRegionInfo context:task optional:true\n", " *   bool_t     is_cRegionInfo_joined()                     check if joined\n", " *   ER             cRegionInfo_getName( char_t* name, int_t max_len );\n", " *   uint16_t       cRegionInfo_getNameLength( );\n", " *   uint32_t       cRegionInfo_getNCell( );\n", " *   ER             cRegionInfo_getCellInfo( uint32_t ith, Descriptor( nTECSInfo_sCellInfo )* des );\n", " *   uint32_t       cRegionInfo_getNRegion( );\n", " *   ER             cRegionInfo_getRegionInfo( uint32_t ith, Descriptor( nTECSInfo_sRegionInfo )* des );\n", " *   [dynamic, optional]\n", " *      void           cRegionInfo_set_descriptor( Descriptor( nTECSInfo_sRegionInfo ) desc );\n", " *      void           cRegionInfo_unjoin(  );\n", " * call port: cCellInfo signature: nTECSInfo_sCellInfo context:task optional:true\n", " *   bool_t     is_cCellInfo_joined()                     check if joined\n", " *   ER             cCellInfo_getName( char_t* name, int_t max_len );\n", " *   uint16_t       cCellInfo_getNameLength( );\n", " *   uint32_t       cCellInfo_getNRawEntryDescriptorInfo( );\n", " *   ER             cCellInfo_getRawEntryDescriptorInfo( int_t index, Descriptor( nTECSInfo_sRawEntryDescriptorInfo )* desc );\n", " *   void           cCellInfo_getCelltypeInfo( Descriptor( nTECSInfo_sCelltypeInfo )* desc );\n", " *   void           cCellInfo_getCBP( void** cbp );\n", " *   void           cCellInfo_getINIBP( void** inibp );\n", " *   [dynamic, optional]\n", " *      void           cCellInfo_set_descriptor( Descriptor( nTECSInfo_sCellInfo ) desc );\n", " *      void           cCellInfo_unjoin(  );\n", " * call port: cSignatureInfo signature: nTECSInfo_sSignatureInfo context:task optional:true\n", " *   bool_t     is_cSignatureInfo_joined()                     check if joined\n", " *   ER             cSignatureInfo_getName( char_t* name, int_t max_len );\n", " *   uint16_t       cSignatureInfo_getNameLength( );\n", " *   uint32_t       cSignatureInfo_getNFunction( );\n", " *   ER             cSignatureInfo_getFunctionInfo( uint32_t ith, Descriptor( nTECSInfo_sFunctionInfo )* desc );\n", " *   [dynamic, optional]\n", " *      void           cSignatureInfo_set_descriptor( Descriptor( nTECSInfo_sSignatureInfo ) desc );\n", " *      void           cSignatureInfo_unjoin(  );\n", " * call port: cCelltypeInfo signature: nTECSInfo_sCelltypeInfo context:task optional:true\n", " *   bool_t     is_cCelltypeInfo_joined()                     check if joined\n", " *   ER             cCelltypeInfo_getName( char_t* name, int_t max_len );\n", " *   uint16_t       cCelltypeInfo_getNameLength( );\n", " *   uint32_t       cCelltypeInfo_getNAttr( );\n", " *   ER             cCelltypeInfo_getAttrInfo( uint32_t ith, Descriptor( nTECSInfo_sVarDeclInfo )* desc );\n", " *   uint32_t       cCelltypeInfo_getNVar( );\n", " *   ER             cCelltypeInfo_getVarInfo( uint32_t ith, Descriptor( nTECSInfo_sVarDeclInfo )* desc );\n", " *   uint32_t       cCelltypeInfo_getNCall( );\n", " *   ER             cCelltypeInfo_getCallInfo( uint32_t ith, Descriptor( nTECSInfo_sCallInfo )* desc );\n", " *   uint32_t       cCelltypeInfo_getNEntry( );\n", " *   ER             cCelltypeInfo_getEntryInfo( uint32_t ith, Descriptor( nTECSInfo_sEntryInfo )* desc );\n", " *   bool_t         cCelltypeInfo_isSingleton( );\n", " *   bool_t         cCelltypeInfo_isIDX_is_ID( );\n", " *   uint32_t       cCelltypeInfo_sizeOfCB( );\n", " *   uint32_t       cCelltypeInfo_sizeOfINIB( );\n", " *   [dynamic, optional]\n", " *      void           cCelltypeInfo_set_descriptor( Descriptor( nTECSInfo_sCelltypeInfo ) desc );\n", " *      void           cCelltypeInfo_unjoin(  );\n", " * call port: cVarDeclInfo signature: nTECSInfo_sVarDeclInfo context:task optional:true\n", " *   bool_t     is_cVarDeclInfo_joined()                     check if joined\n", " *   ER             cVarDeclInfo_getName( char_t* name, int_t max_len );\n", " *   uint16_t       cVarDeclInfo_getNameLength( );\n", " *   void           cVarDeclInfo_getLocationInfo( uint32_t* offset, int8_t* place );\n", " *   void           cVarDeclInfo_getTypeInfo( Descriptor( nTECSInfo_sTypeInfo )* desc );\n", " *   void           cVarDeclInfo_getSizeIsExpr( char_t* expr_str, int32_t max_len );\n", " *   ER             cVarDeclInfo_getSizeIs( uint32_t* size, const void* p_cb );\n", " *   [dynamic, optional]\n", " *      void           cVarDeclInfo_set_descriptor( Descriptor( nTECSInfo_sVarDeclInfo ) desc );\n", " *      void           cVarDeclInfo_unjoin(  );\n", " * call port: cTypeInfo signature: nTECSInfo_sTypeInfo context:task optional:true\n", " *   bool_t     is_cTypeInfo_joined()                     check if joined\n", " *   ER             cTypeInfo_getName( char_t* name, int_t max_len );\n", " *   uint16_t       cTypeInfo_getNameLength( );\n", " *   uint32_t       cTypeInfo_getSize( );\n", " *   int8_t         cTypeInfo_getKind( );\n", " *   uint32_t       cTypeInfo_getNType( );\n", " *   ER             cTypeInfo_getTypeInfo( Descriptor( nTECSInfo_sTypeInfo )* desc );\n", " *   uint32_t       cTypeInfo_getNMember( );\n", " *   ER             cTypeInfo_getMemberInfo( uint32_t ith, Descriptor( nTECSInfo_sVarDeclInfo )* desc );\n", " *   [dynamic, optional]\n", " *      void           cTypeInfo_set_descriptor( Descriptor( nTECSInfo_sTypeInfo ) desc );\n", " *      void           cTypeInfo_unjoin(  );\n", " * call port: cPutString signature: sPutString context:task optional:true\n", " *   bool_t     is_cPutString_joined()                     check if joined\n", " *   void           cPutString_putString( const char_t* string );\n", " *   [dynamic, optional]\n", " *      void           cPutString_set_descriptor( Descriptor( sPutString ) desc );\n", " *      void           cPutString_unjoin(  );\n", " * call port: cTaskBody signature: sTaskBody context:task optional:true\n", " *   bool_t     is_cTaskBody_joined()                     check if joined\n", " *   void           cTaskBody_main( );\n", " *   [dynamic, optional]\n", " *      void           cTaskBody_set_descriptor( Descriptor( sTaskBody ) desc );\n", " *      void           cTaskBody_unjoin(  );\n", " * call port: cREDInfo signature: nTECSInfo_sRawEntryDescriptorInfo context:task optional:true\n", " *   bool_t     is_cREDInfo_joined()                     check if joined\n", " *   uint16_t       cREDInfo_getNRawEntryDescriptorInfo( );\n", " *   ER             cREDInfo_getRawDescriptor( int_t ith, void** rawDesc );\n", " *   [dynamic, optional]\n", " *      void           cREDInfo_set_descriptor( Descriptor( nTECSInfo_sRawEntryDescriptorInfo ) desc );\n", " *      void           cREDInfo_unjoin(  );\n", " *\n", " * #[</PREAMBLE>]# */\n", "\n", "/* プロトタイプ宣言や変数の定義をここに書きます #_PAC_# */\n", "#include \"tTaskMain_tecsgen.h\"\n", "#include <stdio.h>\n", "\n", "#ifndef E_OK\n", "#define\tE_OK\t0\t\t/* success */\n", "#define\tE_ID\t(-18)\t/* illegal ID */\n", "#endif\n", "\n", "static void\n", "call_sTask( CELLCB *p_cellcb, char_t *entry_path );\n", "static void\n", "call_sPutString( CELLCB *p_cellcb, char_t *entry_path, char_t *message );\n", "/* 追加 */\n", "/* Prototype TECSUnit */\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "oshiri\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg);\n", "/* 追加 */\n", "\n", "/* 受け口関数 #_TEPF_# */\n", "/* #[<ENTRY_PORT>]# eBody\n", " * entry port: eBody\n", " * signature:  sTaskBody\n", " * context:    task\n", " * #[</ENTRY_PORT>]# */\n", "\n", "/* #[<ENTRY_FUNC>]# eBody_main\n", " * name:         eBody_main\n", " * global_name:  tTaskMain_eBody_main\n", " * oneway:       false\n", " * #[</ENTRY_FUNC>]# */\n", "void\n", "eBody_main(CELLIDX idx)\n", "{\n", "    CELLCB\t*p_cellcb;\n", "    ER      ercd;\n", "    uint32_t  n;\n", "    Descriptor( nTECSInfo_sNamespaceInfo ) NSdesc;\n", "    Descriptor( nTECSInfo_sRegionInfo )    RGNdesc;\n", "\n", "    if (VALID_IDX(idx)) {\n", "        p_cellcb = GET_CELLCB(idx);\n", "    }\n", "    else {\n", "        /* エラー処理コードをここに記述します */\n", "    } /* end if VALID_IDX(idx) */\n", "\n", "    /* ここに処理本体を記述します #_TEFB_# */\n", "    printf( \"started\\n\" );\n", "\n", "    printf( \"--- rawEntryDescriptor test ---\\n\" );\n", "    call_sTask( p_cellcb, \"HelloWorld.eMain\" );\n", "    call_sPutString( p_cellcb, \"PutStringStdio.ePutString\", \"Hello World!\\n\" );\n", "    /* 追加 */\n", "    /* Call TECSUnit */\n", "    call_sTest( p_cellcb, \"UnitTest.eUnitTest\", 5);\n", "    /* 追加 */\n", "\n", "}\n", "\n", "/* #[<POSTAMBLE>]#\n", " *   これより下に非受け口関数を書きます\n", " * #[</POSTAMBLE>]#*/\n", "\n", "ER getRawEntryDescriptor( CELLCB *p_cellcb, char_t *entry_path, void **rawEntryDesc, char_t *expected_signature )\n", "{\n", "    Descriptor( nTECSInfo_sRawEntryDescriptorInfo ) rawEntryDescDesc;\n", "    Descriptor( nTECSInfo_sEntryInfo )              entryDesc;\n", "    ER     ercd;\n", "    void   *rawDesc;\n", "\n", "    ercd = cTECSInfo_findRawEntryDescriptor( entry_path, &rawEntryDescDesc, &entryDesc );\n", "    if( ercd != E_OK ){\n", "        printf( \"call_sTask: error cTECSInfo_findRawEntryDescriptor( entry_path=%s ) = %d\\n\", entry_path, ercd );\n", "    }\n", "    else {\n", "#define NAME_LEN  (256)\n", "        Descriptor( nTECSInfo_sSignatureInfo )  signatureDesc;\n", "        char_t  name[ NAME_LEN ];\n", "\n", "        cREDInfo_set_descriptor( rawEntryDescDesc );\n", "        cEntryInfo_set_descriptor( entryDesc );\n", "        cEntryInfo_getSignatureInfo( &signatureDesc );\n", "        cSignatureInfo_set_descriptor( signatureDesc );\n", "        ercd = cSignatureInfo_getName( name, NAME_LEN );\n", "        if( ercd != E_OK ){\n", "            printf( \"getRawEntryDescriptor: error cannot get signature name. expectd: '%s'\\n\", expected_signature );\n", "        }\n", "        if( strcmp( name, expected_signature ) != 0 ){\n", "            printf( \"getRawEntryDescriptor: error signature name '%s' mismatch expecting '%s'\\n\", name, expected_signature );\n", "            ercd = E_NOEXS;\n", "        }\n", "        cREDInfo_getRawDescriptor( 0, rawEntryDesc );\n", "    }\n", "    return ercd;\n", "}\n", "\n", "static void\n", "call_sTask( CELLCB *p_cellcb, char_t *entry_path )\n", "{\n", "    ER     ercd;\n", "    void   *rawEntryDesc;\n", "    Descriptor( sTaskBody )      taskBodyDesc;\n", "\n", "    ercd = getRawEntryDescriptor( p_cellcb, entry_path, &rawEntryDesc, \"sTaskBody\" );\n", "    if( ercd == E_OK ){\n", "        setRawEntryDescriptor( taskBodyDesc, sTaskBody, rawEntryDesc );\n", "        cTaskBody_set_descriptor( taskBodyDesc );\n", "        cTaskBody_main();\n", "    }\n", "    else {\n", "        printf( \"call_sTask: errro: cTaskBody_main() not called\\n\" );\n", "    }\n", "}\n", "\n", "\n", "static void\n", "call_sPutString( CELLCB *p_cellcb, char_t *entry_path, char_t *message )\n", "{\n", "    ER     ercd;\n", "    void   *rawEntryDesc;\n", "    Descriptor( sPutString )      putStringDesc;\n", "\n", "    ercd = getRawEntryDescriptor( p_cellcb, entry_path, &rawEntryDesc, \"sPutString\" );\n", "    if( ercd == E_OK ){\n", "        setRawEntryDescriptor( putStringDesc, sPutString, rawEntryDesc );\n", "        cPutString_set_descriptor( putStringDesc );\n", "        cPutString_putString( message );\n", "    }\n", "    else {\n", "        printf( \"call_sPutString: errro: cPutString_putString() not called\\n\" );\n", "    }\n", "}\n", "/* 追加 */\n", "/* Function TECSUnit */\n", "static void\n", "call_sTest( CELLCB *p_cellcb, char_t *entry_path, int arg)\n", "{\n", "    ER     ercd;\n", "    void   *rawEntryDesc;\n", "    Descriptor( sTest )      testDesc;\n", "\n", "    ercd = getRawEntryDescriptor( p_cellcb, entry_path, &rawEntryDesc, \"sTest\" );\n", "    if( ercd == E_OK ){\n", "        setRawEntryDescriptor( putStringDesc, sPutString, rawEntryDesc );\n", "        cPutString_set_descriptor( putStringDesc );\n", "        cPutString_putString( message );\n", "    }\n", "    else {\n", "        printf( \"call_sPutString: errro: cPutString_putString() not called\\n\" );\n", "    }\n", "}\n", "/* 追加 */\n"]
